<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title> -  منوی آنلاین رستوران بزرگ میلاد</title>
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
  
  <style>
    :root{
      --accent: #ff6a00;
      --accent-2: #ffb347;
      --accent-dark: #e55a00;
      --bg: linear-gradient(135deg, #fffaf4 0%, #fff5e6 100%);
      --card: #ffffff;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --muted: #6b7280;
      --shadow: 0 10px 30px rgba(0,0,0,0.1);
      --shadow-hover: 0 20px 40px rgba(0,0,0,0.15);
      --radius: 20px;
      --tap: 60px;
    }
    
    *{box-sizing:border-box;}
    html,body{
      height:100%;margin:0;
      font-family:"Vazirmatn",sans-serif;
      background:var(--bg);
      color:#1f2937;
      overflow-x:hidden;
      user-select:none;
      -webkit-user-select:none;
      touch-action:manipulation;
    }

    /* Particle Background */
    .particles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;}
    .particle{
      position:absolute;width:4px;height:4px;background:var(--accent);border-radius:50%;
      animation:float 6s infinite linear;
    }
    @keyframes float{
      0%{transform:translateY(100vh) rotate(0deg);opacity:0;}
      10%{opacity:1;}
      90%{opacity:1;}
      100%{transform:translateY(-100px) rotate(360deg);opacity:0;}
    }

    /* Header */
    header{
      position:sticky;top:0;
      background:linear-gradient(135deg, var(--accent), var(--accent-2));
      color:white;padding:16px 20px;
      box-shadow:var(--shadow);
      z-index:100;
      display:flex;align-items:center;justify-content:space-between;
      backdrop-filter:blur(20px);
    }
    .logo{
      width:50px;height:50px;
      background:linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
      border-radius:16px;
      display:flex;align-items:center;justify-content:center;
      font-weight:900;font-size:1.4rem;
      box-shadow:0 4px 15px rgba(0,0,0,0.2);
      animation:pulse 2s infinite;
    }
    @keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}

    /* Floating Action Button */
    .fab{
      position:fixed;bottom:90px;right:20px;
      width:60px;height:60px;border-radius:50%;
      background:var(--accent);color:white;
      border:none;box-shadow:var(--shadow-hover);
      font-size:1.5rem;font-weight:700;
      z-index:50;
      transition:all .2s cubic-bezier(0.4,0,0.2,1);
    }
    .fab:hover{transform:scale(1.1) rotate(90deg);}
    .fab:active{transform:scale(0.95) rotate(180deg);}

    /* Main Container */
    main{padding:20px;padding-bottom:140px;position:relative;z-index:10;}

    /* Section Title */
    .section-title{
      margin:20px 0 12px 0;padding:16px 20px;
      background:linear-gradient(135deg, rgba(255,106,0,0.1), rgba(255,179,71,0.05));
      border:2px solid rgba(255,106,0,0.2);
      border-radius:var(--radius);
      font-weight:700;font-size:1.2rem;
      position:relative;overflow:hidden;
    }
    .section-title::before{
      content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);
      animation:shine 2s infinite;
    }
    @keyframes shine{0%{left:-100%}100%{left:100%}}

    /* Enhanced Grid */
    .menu-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
      gap:16px;
    }

    /* Super Interactive Card */
    .card{
      background:linear-gradient(145deg, var(--card), #f8fafc);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:var(--shadow);
      display:flex;flex-direction:column;
      transition:all .3s cubic-bezier(0.4,0,0.2,1);
      position:relative;overflow:hidden;
      min-height:120px;
      cursor:pointer;
      border:1px solid rgba(255,255,255,0.5);
    }
    .card::before{
      content:'';position:absolute;top:0;left:0;right:0;bottom:0;
      background:linear-gradient(135deg, transparent 0%, rgba(255,106,0,0.03) 100%);
      opacity:0;transition:opacity .3s;
    }
    .card:hover{
      transform:translateY(-8px) scale(1.02);
      box-shadow:var(--shadow-hover);
    }
    .card:hover::before{opacity:1;}
    .card:active{transform:scale(0.98);}

    .card h3{
      margin:0 0 8px 0;font-size:1.1rem;font-weight:800;
      background:linear-gradient(135deg, var(--accent), var(--accent-2));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .price{
      font-size:1.2rem;font-weight:900;color:var(--accent);
      margin:4px 0;
      text-shadow:0 2px 4px rgba(255,106,0,0.3);
    }
    .controls{
      display:flex;align-items:center;gap:12px;
      margin-top:16px;justify-content:flex-start;width:100%;
    }

    /* Super Buttons */
    .btn{
      width:52px;height:52px;border-radius:16px;
      border:none;font-size:1.6rem;font-weight:900;
      display:flex;align-items:center;justify-content:center;
      transition:all .2s cubic-bezier(0.4,0,0.2,1);
      position:relative;overflow:hidden;
      min-height:var(--tap);min-width:var(--tap);
    }
    .btn::before{
      content:'';position:absolute;top:0;left:0;right:0;bottom:0;
      background:inherit;opacity:0.2;border-radius:16px;
      transition:opacity .2s;
    }
    .btn.inc{background:var(--success);color:white;box-shadow:0 4px 15px rgba(16,185,129,0.4);}
    .btn.dec{background:var(--danger);color:white;box-shadow:0 4px 15px rgba(239,68,68,0.4);}
    .btn.inc:active,.btn.dec:active{
      transform:scale(0.9);box-shadow:0 2px 8px rgba(0,0,0,0.3);
    }
    .btn.inc::after{content:'+';}
    .btn.dec::after{content:'−';}

    .count{
      min-width:48px;height:48px;text-align:center;
      background:linear-gradient(135deg, var(--accent), var(--accent-2));
      color:white;font-weight:900;font-size:1.3rem;
      border-radius:16px;box-shadow:0 6px 20px rgba(255,106,0,0.4);
      display:flex;align-items:center;justify-content:center;
      transition:all .2s ease;
    }
    .count.animated{animation:bounce 0.6s cubic-bezier(0.68,-0.55,0.265,1.55);}

    @keyframes bounce{
      0%{transform:scale(1);}
      50%{transform:scale(1.3);}
      75%{transform:scale(1.1);}
      100%{transform:scale(1);}
    }

    /* Footer */
    .footer{
      position:fixed;left:0;right:0;bottom:0;
      padding:20px;background:linear-gradient(180deg,rgba(255,255,255,0.95),#fffaf4);
      border-top:1px solid rgba(0,0,0,0.05);
      display:flex;gap:16px;align-items:center;justify-content:space-between;
      box-shadow:0 -10px 30px rgba(0,0,0,0.1);
      z-index:200;
      backdrop-filter:blur(20px);
    }
    .total-text{
      font-weight:900;font-size:1.4rem;
      background:linear-gradient(135deg, var(--accent), var(--accent-2));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .primary{
      background:linear-gradient(135deg, var(--accent), var(--accent-2));
      border:none;color:white;padding:16px 24px;
      border-radius:16px;font-weight:800;font-size:1.1rem;
      box-shadow:0 8px 25px rgba(255,106,0,0.4);
      transition:all .2s ease;
      min-height:56px;
    }
    .primary:active{transform:translateY(2px);box-shadow:0 4px 15px rgba(255,106,0,0.3);}

    /* Toast Notifications */
    .toast{position:fixed;top:20px;right:20px;z-index:300;padding:16px 20px;
           background:var(--success);color:white;border-radius:16px;
           transform:translateX(400px);opacity:0;transition:all .4s ease;}
    .toast.show{transform:translateX(0);opacity:1;}
    .toast.error{background:var(--danger);}

    /* Modal */
    .modal-backdrop{
      position:fixed;inset:0;background:rgba(0,0,0,0.5);
      display:none;align-items:flex-end;justify-content:center;z-index:500;
      backdrop-filter:blur(10px);
    }
    .modal{
      width:95%;max-height:85%;background:#fff;
      border-radius:24px 24px 0 0;padding:24px;
      box-shadow:0 -20px 50px rgba(0,0,0,0.3);
      overflow:auto;animation:slideUp 0.3s ease;
    }
    @keyframes slideUp{from{transform:translateY(100%);}to{transform:translateY(0);}}

    /* Responsive */
    @media (max-width:480px){
      .menu-grid{grid-template-columns:1fr;gap:12px;}
      .card{padding:16px;min-height:110px;}
      header{padding:12px 16px;}
    }
  </style>
</head>
<body>
  <!-- Particle Background -->
  <div class="particles" id="particles"></div>

  <header>
    <div style="display:flex;align-items:center;gap:12px;">
      <div class="logo">ت</div>
      <div>
        <div style="font-weight:900;font-size:1rem;"> منوی آنلاین رستوران بزرگ میلاد</div>
        <div style="font-size:0.9rem;opacity:0.9;">گروه برنامه نویسی هوشمند شهرام دانش </div>
      </div>
    </div>
    <button id="clearBtn" class="primary" style="padding:12px 16px;font-size:0.9rem;">پاک کردن</button>
  </header>

  <main id="main"></main>

  <!-- FAB for Quick Actions -->
  <button id="quick5" class="fab" title="اضافه کردن ۵ عدد">✨</button>

  <!-- Footer -->
  <div class="footer">
    <div>
      <div class="total-text" id="totalTxt">جمع کل: ۰ تومان</div>
      <div style="font-size:0.85rem;color:var(--muted);margin-top:4px;">
        لمس دکمه‌ها • نگه‌داشتن = ×۵ • دوبار لمس = ×۱۰
      </div>
    </div>
    <button id="invoiceBtn" class="primary">🧾 فاکتور</button>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Modal -->
  <div id="modal" class="modal-backdrop">
    <div class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <div>
          <h2 style="margin:0;font-size:1.5rem;font-weight:900;">فاکتور سفارش</h2>
          <div style="color:var(--muted);font-size:0.95rem;" id="invDate"></div>
        </div>
        <div style="display:flex;gap:8px;">
          <button id="printBtn" class="primary" style="padding:12px 16px;">چاپ</button>
          <button id="closeModal" style="background:none;border:1px solid #e5e7eb;
                  color:#374151;padding:12px 16px;border-radius:12px;">بستن</button>
        </div>
      </div>
      <div id="invoiceList" style="margin-bottom:24px;"></div>
      <div style="border-top:1px solid #e5e7eb;padding-top:20px;">
        <div style="display:flex;justify-content:space-between;font-size:1.4rem;
                    font-weight:900;margin-bottom:20px;">
          <span>جمع کل</span>
          <span id="invoiceTotal" style="color:var(--accent);">۰ تومان</span>
        </div>
        <div style="display:flex;gap:12px;">
          <button id="confirmBtn" class="primary" style="flex:1;padding:16px;">✅ ثبت سفارش</button>
          <button id="modalClear" style="flex:1;background:#fef2f2;border:1px solid #fecaca;
                  color:#dc2626;padding:16px;border-radius:12px;font-weight:600;">پاک کردن</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /*************** DATA *****************/
    const menuSections = [
      {section:"🔥 انواع کباب",items:[
        {name:"جوجه کباب",price:120000,id:"k_joje"},
        {name:"کوبیده",price:110000,id:"k_kobide"},
        {name:"کباب گوشت",price:130000,id:"k_goosht"},
        {name:"جگر کباب",price:120000,id:"k_jigar"},
        {name:"دل و قلوه",price:120000,id:"k_delghol"},
        {name:"راسته",price:250000,id:"k_raste"},
        {name:"گوجه",price:30000,id:"k_goje"}
      ]},
      {section:"🍚 انواع برنج",items:[
        {name:"خوشرت قیمه",price:350000,id:"r_khooshrt"},
        {name:"ماهیچه",price:650000,id:"r_mahiche"},
        {name:"چلو جوجه (۲)",price:310000,id:"r_choj_2"},
        {name:"چلو کوبیده (۲)",price:300000,id:"r_chkob_2"}
      ]},
      {section:"🥣 آبگوشت",items:[{name:"آبگوشت سنتی",price:300000,id:"a_abgoosht"}]},
      {section:"🥤 نوشیدنی",items:[
        {name:"نوشابه",price:40000,id:"n_noshabe"},
        {name:"دلستر",price:40000,id:"n_delster"},
        {name:"دوغ",price:40000,id:"n_dough"}
      ]},
      {section:"🥗 سالاد",items:[
        {name:"ماست خیار",price:40000,id:"s_mastkhiyar"},
        {name:"ترشی",price:40000,id:"s_torshi"},
        {name:"زیتون پرورده",price:40000,id:"s_zeitoonpar"}
      ]}
    ];

    /*************** STATE *****************/
    let counts = {};
    let longPressTimers = {};
    let doubleTapTimers = {};
    const STORAGE_KEY = "tanara_order_v2";

    function loadState(){
      try{counts = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};}
      catch(e){counts = {};}
    }
    function saveState(){localStorage.setItem(STORAGE_KEY, JSON.stringify(counts));}

    /*************** RENDER *****************/
    const main = document.getElementById("main");
    const totalTxt = document.getElementById("totalTxt");

    function money(n){return n.toLocaleString()+" تومان";}

    function createParticles(){
      const particles = document.getElementById("particles");
      for(let i=0;i<30;i++){
        const p = document.createElement("div");
        p.className = "particle";
        p.style.left = Math.random()*100+"%";
        p.style.animationDelay = Math.random()*6+"s";
        p.style.animationDuration = (4+Math.random()*4)+"s";
        particles.appendChild(p);
      }
    }

    function showToast(message, isError=false){
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.className = `toast ${isError ? 'error' : ''} show`;
      setTimeout(()=>toast.classList.remove('show'), 2500);
    }

    function renderMenu(){
      main.innerHTML = "";
      menuSections.forEach(sec => {
        const title = document.createElement("div");
        title.className = "section-title";
        title.textContent = sec.section;
        main.appendChild(title);

        const grid = document.createElement("div");
        grid.className = "menu-grid";

        sec.items.forEach(item => {
          const count = counts[item.id] || 0;
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <div style="flex:1;display:flex;flex-direction:column;justify-content:center;">
              <h3>${item.name}</h3>
              <div class="price">${money(item.price)}</div>
              <div style="font-size:0.85rem;color:var(--muted);margin-top:4px;">هر پرس</div>
            </div>
            <div class="controls">
              <button class="btn dec" data-id="${item.id}" data-name="${item.name}">−</button>
              <div class="count" id="cnt-${item.id}">${count}</div>
              <button class="btn inc" data-id="${item.id}" data-name="${item.name}">+</button>
            </div>
          `;
          grid.appendChild(card);
        });
        main.appendChild(grid);
      });
      attachControls();
      updateTotal();
    }

    /*************** SUPER CONTROLS *****************/
    function attachControls(){
      // Single tap
      document.querySelectorAll(".inc, .dec").forEach(btn => {
        const id = btn.dataset.id;
        const delta = btn.classList.contains("inc") ? 1 : -1;
        
        // CLICK/TAP
        btn.addEventListener("click", (e) => {
          e.preventDefault();
          updateCount(id, delta);
        });

        // DOUBLE TAP - ×10
        let tapCount = 0;
        btn.addEventListener("dblclick", (e) => {
          e.preventDefault();
          updateCount(id, delta * 10);
          showToast(`${btn.dataset.name} ×۱۰`);
        });

        // LONG PRESS - ×5
        let pressTimer;
        btn.addEventListener("touchstart", (e) => {
          pressTimer = setTimeout(() => {
            updateCount(id, delta * 5);
            showToast(`${btn.dataset.name} ×۵`);
          }, 400);
        });

        btn.addEventListener("touchend", () => {
          clearTimeout(pressTimer);
        });

        // Mouse support
        btn.addEventListener("mousedown", () => {
          pressTimer = setTimeout(() => {
            updateCount(id, delta * 5);
          }, 400);
        });
        btn.addEventListener("mouseup", () => clearTimeout(pressTimer));
        btn.addEventListener("mouseleave", () => clearTimeout(pressTimer));
      });
    }

    function updateCount(id, delta){
      counts[id] = Math.max(0, (counts[id] || 0) + delta);
      const countEl = document.getElementById(`cnt-${id}`);
      countEl.textContent = counts[id];
      countEl.classList.add("animated");
      setTimeout(()=>countEl.classList.remove("animated"), 600);
      
      saveState();
      updateTotal();
    }

    function updateTotal(){
      let total = 0;
      menuSections.forEach(sec => sec.items.forEach(it => {
        total += (counts[it.id] || 0) * it.price;
      }));
      totalTxt.textContent = `جمع کل: ${total.toLocaleString()} تومان`;
      totalTxt.style.transform = total > 0 ? "scale(1.1)" : "scale(1)";
      setTimeout(()=>totalTxt.style.transform="scale(1)", 200);
      return total;
    }

    /*************** QUICK ACTIONS *****************/
    document.getElementById("quick5").addEventListener("click", () => {
      let added = 0;
      Object.keys(counts).forEach(id => {
        if(counts[id] > 0){
          counts[id] += 5;
          added++;
        }
      });
      if(added > 0){
        saveState();
        renderMenu();
        showToast(`×۵ برای ${added} آیتم`);
      }
    });

    /*************** MODAL & INVOICE *****************/
    const modal = document.getElementById("modal");

    document.getElementById("invoiceBtn").addEventListener("click", showInvoice);
    document.getElementById("closeModal").addEventListener("click", hideModal);
    document.getElementById("clearBtn").addEventListener("click", () => {
      if(confirm("تمام سفارش پاک شود؟")){
        counts = {}; saveState(); renderMenu();
        showToast("سفارش پاک شد", true);
      }
    });

    document.getElementById("confirmBtn").addEventListener("click", () => {
      showToast("✅ سفارش ثبت شد!");
      // counts = {}; saveState(); renderMenu(); hideModal();
    });

    document.getElementById("modalClear").addEventListener("click", () => {
      if(confirm("تمام سفارش پاک شود؟")){
        counts = {}; saveState(); renderMenu(); hideModal();
        showToast("سفارش پاک شد", true);
      }
    });

    function showInvoice(){
      const list = document.getElementById("invoiceList");
      list.innerHTML = "";
      let total = 0;
      let hasItems = false;

      menuSections.forEach(sec => sec.items.forEach(it => {
        const c = counts[it.id] || 0;
        if(c > 0){
          hasItems = true;
          total += c * it.price;
          const row = document.createElement("div");
          row.style.cssText = "display:flex;justify-content:space-between;padding:16px 0;border-bottom:1px solid #f3f4f6;";
          row.innerHTML = `
            <div style="text-align:left;">
              <div style="font-weight:700;font-size:1.1rem;">${money(c * it.price)}</div>
              <div style="font-size:0.85rem;color:var(--muted);">${it.price.toLocaleString()} × ${c}</div>
            </div>
            <div style="font-weight:600;color:var(--accent);">${it.name}</div>
          `;
          list.appendChild(row);
        }
      }));

      if(!hasItems){
        list.innerHTML = '<div style="padding:40px;text-align:center;color:var(--muted);"><div style="font-size:2rem;margin-bottom:12px;">🛒</div>سفارشی انتخاب نشده</div>';
      }

      document.getElementById("invoiceTotal").textContent = total.toLocaleString() + " تومان";
      document.getElementById("invDate").textContent = new Date().toLocaleString("fa-IR");
      modal.style.display = "flex";
    }

    function hideModal(){
      modal.style.display = "none";
    }

    document.getElementById("printBtn").addEventListener("click", () => {
      const win = window.open('','_blank');
      win.document.write(`
        <!DOCTYPE html><html lang="fa" dir="rtl"><head>
        <meta charset="utf-8"><title>فاکتور تن آرا</title>
        <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
        <style>body{font-family:Vazirmatn,sans-serif;margin:40px;padding:40px;max-width:600px;margin:auto;background:#fff;}
        h1{color:#ff6a00;font-size:2rem;text-align:center;margin-bottom:10px;}
        .item{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #eee;}
        .total{font-size:1.5rem;font-weight:900;text-align:left;color:#ff6a00;padding-top:20px;}
        </style></head><body>
        <h1>🍽️ فاکتور رستوران تن آرا</h1>
        <div style="text-align:center;color:#666;margin-bottom:30px;">${new Date().toLocaleString("fa-IR")}</div>
        ${document.getElementById("invoiceList").innerHTML}
        <div class="total" style="border-top:2px solid #ff6a00;">
          <span>جمع کل: ${document.getElementById("invoiceTotal").textContent}</span>
        </div>
        </body></html>
      `);
      win.document.close();
      win.print();
    });

    modal.addEventListener("click", e => {
      if(e.target === modal) hideModal();
    });

    /*************** INIT *****************/
    loadState();
    createParticles();
    renderMenu();

    // Auto-save
    setInterval(saveState, 2000);
  </script>
</body>
</html>